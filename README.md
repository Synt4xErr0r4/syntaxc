# SyntaxC

An ANSI-C (C89, C90) compiler written in Java 18.

## Motivation and Goals

This project was developed as part of my [pre-scientific thesis](https://www.ahs-vwa.at/) on how compilers operate, specifically a compiler for the (ANSI-)C language (also known as C89 and C90). The main goal of this compiler is to produce assembly code for the x86 platform on Linux (32 and 64 bits). However, this could easily be expanded (e.g., to support ARM or Windows) due to the already existing [modularized target architecture system](https://github.com/Synt4xErr0r4/syntaxc/blob/main/src/main/java/at/syntaxerror/syntaxc/generator/arch/ArchitectureRegistry.java). All features specified by the standard ([see below](#sources)) and also some newer/non-standard features ([see below](#extensions)) are supported. The command line syntax is similar or even identical to GCC's system (e.g., `-E` only generates the output of the preprocessor), and also the generated assembly code is aimed to match/be similar to GCC's output. However, this compiler only supports a handfull of the various optimizations, and the output is therefore usually only comparable to GCC when using the command line option `-O0` (generally disables all of GCC's aggressive optimizations). This compiler does *not* support assembling or linking by itself, only the assembly code is generated by this compiler and the result is then passed to GCC (unless the `-E` or `-S` option is present, in which case the compilation is stopped after the preprocessor or code generator, respectively). The `-c` option, if supplied, will be forwarded to GCC and inhibit any linking of the output binary.

## Dependencies

All dependencies are also listed in the [pom.xml file](https://github.com/Synt4xErr0r4/syntaxc/blob/main/pom.xml).

- [Lombok](https://projectlombok.org/) (used to reduce boiler plate code)
- [JNA](https://github.com/java-native-access/jna) (used to determine the default target architecture)
- [graphviz-java](https://github.com/nidi3/graphviz-java) (used to generate syntax trees and control flow graphs)
- [big-math](https://github.com/eobermuhlner/big-math) (used for calculating logarithms on `java.math.BigDecimal`s)

## Supported optimizations

### `-Oconst-folding`

Automatically inlines global (arithmetic) variables declared as `const`.

before:

```c
const int j = 3;

/* ... */

/* ... */ j * 4 /* ... */
```

after:

```c
const j = 3;

/* ... */

/* ... */ 12 /* ... */
```

### `-Ogoto`

Automatically removes `goto` statements followed by the label they jump to.

before:

```c
    /* ... */
    goto label;
label:
    /* ... */
```

after:

```c
    /* ... */
label:
    /* ... */
```

### `-Ojump-to-jump`

Automatically chooses the shortest path instead of jumping several times in a row.

before:

```c
    /* ... */
    goto label1;
    /* ... */
label1:
    goto label2;
    /* ... */
label2:
    goto label3;
    /* ... */
label3:
    /* ... */
```

after:

```c
    /* ... */
    goto label3;
    /* ... */
label1:
    goto label3;
    /* ... */
label2:
    goto label3;
    /* ... */
label3:
    /* ... */
```

## Usage

Compile a file using:

`java -jar syntaxc.jar input_file.c`

The output file will be named `input_file.o`

For full documentation of all command line parameters,
use `java -jar syntaxc.jar --help`.  
You can also use `--doc option_here` to get extended documentation about a specific option (e.g. `--doc D` prints the documentation for the `-D` option).

## Extensions

The following extensions are supported:

- `#elifdef`, `#elifndef` (C23 feature)  
  else-versions of `#ifdef` and `#ifndef`

- `__FUNCTION__`, `__func__` (GNU extension, C99 feature)  
  Returns the name of the current function.
  `__FUNCTION__` is a macro that expands to `__func__`,
  a local variable implicitly declared at the start of
  each function (as `static const char __func__[] = "function-name";`).  
  Note that the original GNU extension for `__FUNCTION__` did not declare
  it as a macro but as a synonym for `__func__`.

- *binary literals* (C23 feature)  
  When a number is prefixed with `0b`, it is interpreted as a binary literal (similar to hexadecimal literals [`0x` prefix] and octal literals [`0` prefix])

All extensions can be disabled by using the appropriate command line option:

- `-fno-elifdef`: disables `#elifdef` and `#elifndef`
- `-fno-func`: disables `__func__`
- `-fno-binary-literals`: disables binary literals

## Sources

*This list is currently incomplete.*

- [ANSI/ISO 9899-1990; ANSI X3.159-1989](https://www.iso.org/standard/17782.html) (ANSI-C/C89/C90 Standard) - officially withdrawn, but still available here:
  - [https://www.yodaiken.com/wp-content/uploads/2021/05/ansi-iso-9899-1990-1.pdf](https://www.yodaiken.com/wp-content/uploads/2021/05/ansi-iso-9899-1990-1.pdf)
  - [https://web.archive.org/web/20190210174230/http://read.pudn.com/downloads133/doc/565041/ANSI_ISO%2B9899-1990%2B%5B1%5D.pdf](https://web.archive.org/web/20190210174230/http://read.pudn.com/downloads133/doc/565041/ANSI_ISO%2B9899-1990%2B%5B1%5D.pdf) (archived)
  - [https://web.archive.org/web/20200909074736/https://www.pdf-archive.com/2014/10/02/ansi-iso-9899-1990-1/ansi-iso-9899-1990-1.pdf](https://web.archive.org/web/20200909074736/https://www.pdf-archive.com/2014/10/02/ansi-iso-9899-1990-1/ansi-iso-9899-1990-1.pdf) (archived)
- [Calling Conventions](https://agner.org/optimize/calling_conventions.pdf)
- [System V AMD64 ABI](https://raw.githubusercontent.com/wiki/hjl-tools/x86-psABI/x86-64-psABI-1.0.pdf) (for the x64 Linux calling convention)
- [Predefined Macros](https://sourceforge.net/p/predef/wiki/)
- [ANSI Escape Sequences](https://en.wikipedia.org/wiki/ANSI_escape_code#3-bit_and_4-bit) (for colored console output)
- [termd/Wcwidth](https://github.com/termd/termd/blob/master/src/main/java/io/termd/core/util/Wcwidth.java) (at.syntaxerror.syntaxc.logger.WCWidth, for determining the width of unicode characters)
